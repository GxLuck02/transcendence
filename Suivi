25/11/2025 - Début de session : analyse du module live chat, pas encore de modifications appliquées.
25/11/2025 - Mise à jour chat.service.ts : construction de l’URL WebSocket basée sur l’origine backend (ou VITE_BACKEND_ORIGIN) pour garantir l’utilisation de wss://localhost:8443/ws/chat/ en dev.
25/11/2025 - Ajout d’une gestion centralisée des 401 : auth.service.ts, main.ts et chat.service.ts forcent désormais la déconnexion/redirection vers /login lorsqu’un token devient invalide, évitant les états bloqués “Invalid or missing token”.
25/11/2025 - Corrections backend chat : requêtes SQL réécrites pour supprimer les erreurs (alias user_id, colonnes ambiguës) et garde-fou sur /ws/chat/ afin d’éviter les crashs lorsque la connexion n’est pas WebSocket.
27/11/2025 - Phase 1.1 module blockchain : alignement smart contract avec les besoins backend. Ajout du champ winnerScore dans la struct Tournament, mise à jour de storeTournament pour accepter le score, ajout de la fonction getTournamentWinner pour compatibilité backend, et mise à jour de l’événement TournamentStored. Backend mis à jour pour utiliser storeTournament avec 4 paramètres (id, name, username, score) et ABI corrigé.
27/11/2025 - Création script de test local (test-blockchain-local.js) : vérifie la syntaxe du contrat, l'ABI backend, la structure de la base de données, les validations de données, et optionnellement la connexion Web3 avec un provider local. Script exécutable via npm run test:blockchain.
27/11/2025 - Validation locale complète : vérification manuelle confirmant que le smart contract (winnerScore, storeTournament avec 4 paramètres, getTournamentWinner), le backend (ABI correct, routes alignées), et la base de données (table blockchain_scores) sont tous correctement configurés. Création de VALIDATION_LOCALE.md avec guide de test et cas de validation. Test exécuté avec succès dans le container Docker : tous les tests passent (syntaxe contrat, ABI backend, structure DB, validations données). Procédure de copie des fichiers dans le container documentée.
03/12/2025 - Phase 2 module blockchain : création du script de déploiement (deploy-contract.js) pour déployer le contrat TournamentScore sur Avalanche Fuji testnet. Le script vérifie la connexion, le solde, déploie le contrat, teste les fonctions, et affiche l'adresse du contrat. Script ajouté au package.json : npm run deploy:contract.
08/12/2025 - Automatisation compilation ABI et bytecode : modification de deploy-contract.js pour compiler automatiquement l'ABI et le bytecode depuis le contrat Solidity via solc. L'ABI est maintenant compilé automatiquement (remplace l'ABI manuel), et le bytecode est compilé automatiquement sauf si fourni via CONTRACT_BYTECODE dans .env. Plus besoin de définir manuellement l'ABI dans le code. Seule la clé privée (BLOCKCHAIN_PRIVATE_KEY) est requise dans .env, le bytecode étant optionnel.
10/12/2025 - Enregistrement automatique tournoi sur blockchain : ajout de la fonctionnalité pour enregistrer automatiquement le score du gagnant du tournoi sur la blockchain à la fin du tournoi. Ajout de getFinalMatch() et recordTournamentOnBlockchain() dans TournamentManager pour récupérer le match final et appeler l'API blockchain. Modification de main.ts pour appeler automatiquement l'enregistrement quand isFinal === true. Le score du gagnant dans le match final est récupéré et envoyé à l'API /api/blockchain/tournament/record/ avec l'ID du tournoi, le nom, le username du gagnant et son score.
10/12/2025 - Affichage hash transaction dans fenêtre gagnant : modification de showTournamentMatchResult() pour afficher le hash de la transaction blockchain dans la fenêtre du gagnant quand c'est un match final. Le hash est affiché dans une zone sélectionnable (user-select: all) pour faciliter le copier-coller, avec un lien direct vers l'explorateur Snowtrace. Le callback onGameOver est maintenant async pour attendre le résultat de l'enregistrement blockchain avant d'afficher la fenêtre. Le hash et le numéro de block sont passés en paramètres à showTournamentMatchResult().
